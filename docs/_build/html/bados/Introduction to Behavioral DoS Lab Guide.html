

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Lab Network Overview &mdash; Introduction to ASM/AWAF Behavioral DoS 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="logging" href="logging.html" />
    <link rel="prev" title="Agility 2018" href="Intro to ASM Behavioral DoS.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Introduction to ASM/AWAF Behavioral DoS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Configuration Steps:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Intro to ASM Behavioral DoS.html">Agility 2018</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lab Network Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="#accessing-the-lab-environment">Accessing the lab environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="#exercise-1-ddos-mitigation-using-behavior-analysis">Exercise 1 – DDos Mitigation Using Behavior Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mitigating-l7-ddos-attacks-using-behavioral-analysis">Mitigating L7 DDoS Attacks Using Behavioral Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#set-up-the-dos-profile">Set up the DoS profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-dos-logging-profile">Create a DoS Logging profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-the-dos-profile-to-a-virtual-server">Add the DoS profile to a virtual server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initiate-the-good-traffic-script">Initiate the Good Traffic script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initiated-a-l7-ddos-attack">Initiated a L7 DDoS attack</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#exercise-2-mitigating-bot-attacks">Exercise 2 - Mitigating BoT Attacks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mitigating-bots-using-a-dos-profile">Mitigating Bots using a DOS profile</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initiate-a-bot-attack">Initiate a bot attack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-modifying-a-dos-profile">Creating/Modifying a DoS Profile</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="profile.html">profile</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Introduction to ASM/AWAF Behavioral DoS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Lab Network Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/bados/Introduction to Behavioral DoS Lab Guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>Agility 2018 Self-Guided Lab: Introduction to ASM/AWAF Behavioral DoS</p>
<p>Participant Hands-on Lab Guide</p>
<p><a class="reference internal" href="../_images/image1.png"><img alt="image0" src="../_images/image1.png" style="width: 1.93667in; height: 0.61667in;" /></a></p>
<p>Last Updated: <em>5/4/2018</em></p>
<p>©2015 F5 Networks, Inc. All rights reserved. F5, F5 Networks, and the F5
logo are trademarks of F5 Networks, Inc. in the U.S. and in certain
other countries. Other F5 trademarks are identified at f5.com.</p>
<p>Any other products, services, or company names referenced herein may be
trademarks of their respective owners with no endorsement or
affiliation, express or implied, claimed by F5.</p>
<p><strong>Table of Contents</strong></p>
<p><a class="reference external" href="#_Toc513196258">Lab Network Overview 2</a></p>
<p><a class="reference external" href="#accessing-the-lab-environment">Accessing the lab environment 4</a></p>
<p><a class="reference external" href="#_Toc513196260">Exercise 1 – DDos Mitigation Using Behavior Analysis
6</a></p>
<p><a class="reference external" href="#mitigating-l7-ddos-attacks-using-behavioral-analysis">Mitigating L7 DDoS Attacks Using Behavioral Analysis
6</a></p>
<p><a class="reference external" href="#set-up-the-dos-profile">Set up the DoS profile 6</a></p>
<p><a class="reference external" href="#create-a-dos-logging-profile">Create a DoS Logging profile 8</a></p>
<p><a class="reference external" href="#add-the-dos-profile-to-a-virtual-server">Add the DoS profile to a virtual server
9</a></p>
<p><a class="reference external" href="#initiate-the-good-traffic-script">Initiate the Good Traffic script
11</a></p>
<p><a class="reference external" href="#initiated-a-l7-ddos-attack">Initiated a L7 DDoS attack 12</a></p>
<p><a class="reference external" href="#exercise-2---mitigating-bot-attacks">Exercise 2 - Mitigating BoT Attacks
14</a></p>
<p><a class="reference external" href="#mitigating-bots-using-a-dos-profile">Mitigating Bots using a DOS profile
14</a></p>
<p><a class="reference external" href="#initiate-a-bot-attack">Initiate a bot attack 14</a></p>
<p><a class="reference external" href="#creatingmodifying-a-dos-profile">Creating/Modifying a DoS Profile
15</a></p>
<div class="section" id="lab-network-overview">
<h1>Lab Network Overview<a class="headerlink" href="#lab-network-overview" title="Permalink to this headline">¶</a></h1>
<p>Each student will have a BIG-IP VE environment with IP addressing as
below:</p>
<p><a class="reference internal" href="../_images/image2.png"><img alt="image1" src="../_images/image2.png" style="width: 6.59740in; height: 6.73203in;" /></a></p>
</div>
<div class="section" id="accessing-the-lab-environment">
<h1>Accessing the lab environment<a class="headerlink" href="#accessing-the-lab-environment" title="Permalink to this headline">¶</a></h1>
<ol class="loweralpha">
<li><dl class="first docutils">
<dt>Open a browser and go to <a href="#id1"><span class="problematic" id="id2">`</span></a><a class="reference external" href="http://training.f5agililty.com">http://training.f5agililty.com</a>/&lt;lab</dt>
<dd><p class="first last">number&gt;/X &lt;<a class="reference external" href="http://training.f5agililty.com/%3clab%20number%3e/X">http://training.f5agililty.com/%3clab%20number%3e/X</a>&gt;`__
(where <strong>X</strong> is your student number)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Look for the <strong>xubuntu-jumpbox-vxx</strong>. You will use the xubuntu</dt>
<dd><blockquote class="first">
<div><p>jumpbox for all the labs. (see below)</p>
</div></blockquote>
<p class="last"><a class="reference internal" href="../_images/image3.png"><img alt="image2" src="../_images/image3.png" style="width: 3.77500in; height: 2.87104in;" /></a></p>
</dd>
</dl>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">You can click on <strong>RDP</strong> to RDP to the Xubuntu jumpbox or you can
select the <strong>CONSOLE</strong> link and access the jumpbox via your browser.
<strong>The CONSOLE link requires you turn off pop-up blockers.</strong></p>
<blockquote>
<div><p><a class="reference internal" href="../_images/image4.png"><img alt="image3" src="../_images/image4.png" style="width: 3.36587in; height: 3.04167in;" /></a></p>
</div></blockquote>
</li>
</ol>
<ol class="arabic simple">
<li>Open the Chrome browser and log into the BIG-IP GUI to verify the
BIG-IP is up.<ol class="loweralpha">
<li>Go to <strong>https://10.1.1.245</strong><ol class="lowerroman">
<li>User: <strong>admin</strong></li>
<li>Password: <strong>admin</strong></li>
</ol>
</li>
</ol>
</li>
<li>Now you will perform an initial configuration via command line.<ol class="loweralpha">
<li>Open a terminal window from the taskbar at the bottom.<ol class="lowerroman">
<li>Log in to the BIG-IP using the command: <strong>ssh
root&#64;10.1.1.245</strong></li>
<li>The password is <strong>default.</strong></li>
<li>At the BIG-IP prompt, enter <strong>tmsh</strong><ol class="arabic">
<li>This will place you in the BIG-IP command line mode.</li>
</ol>
</li>
</ol>
</li>
<li>In your browser, open then the <strong>Lab Guides</strong> link on the
bookmarks bar in a new tab/window.</li>
<li>Open the <strong>AdvWAF Base Setup.txt</strong> file and review the commands.</li>
<li>Copy all the commands between <strong># BEGIN COPY - Lab prep</strong> and <strong>#
END COPY - Lab prep</strong></li>
<li>Paste the commands into the terminal window at the <strong>tmsh</strong>
prompt.</li>
<li><strong>The BIG-IP will take several minutes to come back online.</strong><ol class="lowerroman">
<li>Good time for a bathroom break. Smoke ‘em if you got ‘em.</li>
</ol>
</li>
</ol>
</li>
<li>Verify the virtual server and web site are up and running.<ol class="loweralpha">
<li>Go to <strong>Local Traffic &gt;&gt; Network Map</strong>. There should be two
virtual servers and all should be available (green).</li>
<li>Open up the Firefox browser. Go to <a class="reference external" href="http://hackazon.f5demo.com">http://hackazon.f5demo.com</a> and
<a class="reference external" href="https://hackazon.f5demo.com">https://hackazon.f5demo.com</a></li>
<li></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="exercise-1-ddos-mitigation-using-behavior-analysis">
<h1>Exercise 1 – DDos Mitigation Using Behavior Analysis<a class="headerlink" href="#exercise-1-ddos-mitigation-using-behavior-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mitigating-l7-ddos-attacks-using-behavioral-analysis">
<h2>Mitigating L7 DDoS Attacks Using Behavioral Analysis<a class="headerlink" href="#mitigating-l7-ddos-attacks-using-behavioral-analysis" title="Permalink to this headline">¶</a></h2>
<p>Objectives:</p>
<ul class="simple">
<li>Set up BaDos Profile</li>
<li>Run good traffic script for BaDoS Learning</li>
<li>Run DoS Attack</li>
<li>Observe BIG-IP create Dynamic Signatures and migitate DoS attack</li>
<li>Estimated time for completion: <strong>xx minutes</strong></li>
</ul>
<div class="section" id="set-up-the-dos-profile">
<h3>Set up the DoS profile<a class="headerlink" href="#set-up-the-dos-profile" title="Permalink to this headline">¶</a></h3>
<p>In the section you will create a DoS profile with behavioral analysis
configure and attach the DoS profile to the virtual server. You will
also modify the virtual server by adding an iRule to put random IPs into
the x-forward for (XFF) hear, modify an http profile to insert the XFF
header and modify the to the results look more interesting.</p>
<ol class="arabic">
<li><p class="first">You will need to create a new DoS profile before you can configure
DoS mitigation. Go to <strong>Security ›› DoS Protection : DoS Profiles</strong>
and select <strong>Create</strong>. Name your profile <strong>hackazon_bados</strong> and
select <strong>Finished</strong>. Open your <strong>hackazon_bados</strong> DoS profile.</p>
</li>
<li><p class="first">There are no changes need to the properties. Select <strong>Application
Security</strong> from the top bar.</p>
<blockquote>
<div><p><a class="reference internal" href="../_images/image5.png"><img alt="image4" src="../_images/image5.png" style="width: 3.67316in; height: 1.64455in;" /></a></p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">This rest of the DoS profile configuration will take place in this
screen. Begin with <strong>General Settings</strong>, select <strong>Edit</strong> to the right
of <strong>Application Security</strong> in the left-hand box and check the
<strong>Enable</strong> box.</p>
<blockquote>
<div><p>This will active the other sections.</p>
<p><a class="reference internal" href="../_images/image6.png"><img alt="image5" src="../_images/image6.png" style="width: 4.17536in; height: 2.11178in;" /></a></p>
</div></blockquote>
</li>
</ol>
<p>**NOTE** At any point you can save your changes by hitting the
<strong>Update</strong> button in the lower left-hand corner</p>
<ol class="arabic">
<li><p class="first">Select the <strong>Bot Signatures</strong> section, select the <strong>Edit</strong> link to
the right of <strong>Bot Signature Check</strong>, check the <strong>Enabled</strong> box. The
message in red below the <strong>Enabled</strong> box indicates a DNS Resolver has
not been set up. The DNS resolver is use for reverse lookups which
are part of some mitigate techniques but are not necessary for this
lab. Select edit next to <strong>Bot Signature Categories</strong> and change both
the <strong>Malicious Categories</strong> and <strong>Benign Categories</strong> to <strong>Report</strong>,
since you will be using bots to generate traffic.</p>
<blockquote>
<div><p><a class="reference internal" href="../_images/image7.png"><img alt="image6" src="../_images/image7.png" style="width: 4.26789in; height: 3.18483in;" /></a></p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Select <strong>TPS-base DoS Detection</strong> and set the <strong>Operation Mode</strong> to
<strong>Off</strong>.</p>
<blockquote>
<div><p><a class="reference internal" href="../_images/image8.png"><img alt="image7" src="../_images/image8.png" style="width: 4.31754in; height: 1.02821in;" /></a></p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Select <strong>Behavioral &amp; Stress-based Detection</strong> and edit to
<strong>Operation Mode</strong> to <strong>Blocking</strong>.</p>
<ol class="loweralpha simple">
<li>Set the <strong>Thresholds Mode</strong> to <strong>Automatic</strong>.</li>
<li>Under <strong>Stress-based Detection and Mitigation</strong> edit <strong>By Source
IP</strong> and uncheck <strong>Request Blocking.</strong> Under <strong>By URL</strong> uncheck
<strong>Heavy URL Protection</strong> and <strong>Request Blocking</strong>.</li>
<li>Under Behavioral Detection and Mitigation check the <strong>Bad actors
behavior detection</strong> and <strong>Request signatures detection</strong> and set
the <strong>Mitigation</strong> to <strong>Standard</strong>.</li>
<li>Hit <strong>Update</strong> in the lower left-hand corner. <strong>Close</strong> all the
sections <strong>Behavioral &amp; Stress-based Detection</strong> should match the
figure below.</li>
</ol>
<blockquote>
<div><p><a class="reference internal" href="../_images/image9.png"><img alt="image8" src="../_images/image9.png" style="width: 3.41706in; height: 2.49689in;" /></a></p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="create-a-dos-logging-profile">
<h3>Create a DoS Logging profile<a class="headerlink" href="#create-a-dos-logging-profile" title="Permalink to this headline">¶</a></h3>
<p>Like with Advance WAF aka ASM you will create a logging profile to
capture DoS events.</p>
<ol class="arabic">
<li><p class="first">Go to <strong>Security ›› Event Logs : Logging Profiles</strong> and select
<strong>Create</strong>. Name your profile <strong>l7_dos_bot_logger</strong>. Check the
<strong>DoS Protection</strong> and <strong>Bot Defense</strong> enable boxes.</p>
<ol class="loweralpha simple">
<li>In the <strong>DoS Protection</strong> tab enable the <strong>Local Publisher</strong>.</li>
<li>In the <strong>Bot Defense</strong> tab check ALL the boxes.</li>
<li>Hit <strong>Finished</strong>.</li>
</ol>
<blockquote>
<div><p><a class="reference internal" href="../_images/image10.png"><img alt="image9" src="../_images/image10.png" style="width: 3.14894in; height: 3.14894in;" /></a></p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="add-the-dos-profile-to-a-virtual-server">
<h3>Add the DoS profile to a virtual server<a class="headerlink" href="#add-the-dos-profile-to-a-virtual-server" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>The DOS profile has only BaDOS enabled + Bot Signatures (only
reporting for all categories).</div></blockquote>
<p>Keep in mind, in real world environment the best practice is to block
malicious categories.</p>
<ol class="arabic">
<li><p class="first">Go to <strong>Local Traffic &gt; Virtual Servers &gt; Virtual Server List</strong> and
select <strong>vs_hackazon_http</strong>. Under the <strong>Security</strong> tab on the top
bar select <strong>Policies</strong>.</p>
</li>
<li><p class="first">Enable the <strong>DoS Protection Profile</strong> and select the
<strong>hackazon_bados</strong> profile.</p>
</li>
<li><p class="first">Add <strong>l7_dos_bot_logger</strong> to the <strong>Log Profile</strong> and <strong>Update</strong></p>
</li>
<li><p class="first">For purposes of this lab, <strong>Disable</strong> the <strong>Application Security
Policy</strong> and remove <strong>asm_allrequests</strong> from the <strong>Log Profile.</strong></p>
<blockquote>
<div><p><a class="reference internal" href="../_images/image11.png"><img alt="image10" src="../_images/image11.png" style="width: 2.05210in; height: 1.69793in;" /></a></p>
<p>Because we don´t have dozens of good and bad source IPs available
for clients and attackers in this environment, we simulate them by
adding an iRule to the VS, which adds a randomized X-Forwarded-For
(XFF) header to each request and a http profile which enables to
insert XFF into the HTTP headers.</p>
<p><strong>XFF_mixed_Attacker_Good_iRule</strong></p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Go to <strong>Local Traffic ›› iRules : iRule List</strong> and select <strong>Create.</strong>
Name the new iRule <strong>XFF_mixed_Attacker_Good_iRule.</strong> Copy and
paste the iRule below.</p>
<blockquote>
<div><p>when HTTP_REQUEST {</p>
<p># Good traffic</p>
<p>if { [IP::addr [IP::client_addr] equals 10.1.10.52] } {</p>
<p>set xff 153.172.223.[expr int(rand()*100)]</p>
<p><a class="reference external" href="HTTP::header">HTTP::header</a> insert X-Forwarded-For $xff</p>
<p>}</p>
<p># Attack traffic</p>
<p>if { [IP::addr [IP::client_addr] equals 10.1.10.53] } {</p>
<p>set xff 132.173.99.[expr int(rand()*25)]</p>
<p><a class="reference external" href="HTTP::header">HTTP::header</a> insert X-Forwarded-For $xff</p>
<p>}</p>
<p>}</p>
<p>AdvWAF/ASM can honor the X-Forwarded-For header by enabling this in
the http-profile.</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first"><a class="reference internal" href="../_images/image12.png"><img alt="image11" src="../_images/image12.png" style="width: 3.29097in; height: 0.41319in;" /></a>Go to <strong>Local Traffic ›› Profiles : Services : HTTP</strong> and
select <strong>Create</strong>. Name the new http profile <strong>xff_http</strong> and enable
<strong>Accept XFF</strong>.</p>
<blockquote>
<div><p>Go to the <strong>vs_hackazon_http</strong> virtual server. In the
<strong>Properties</strong> tab, under <strong>Configuration</strong> section, select
<strong>xff_http</strong> for the <strong>HTTP Profile</strong>. In the <strong>Resource</strong> tab, in
the <strong>iRules</strong> section select the <strong>Managed</strong> button and move
<strong>XFF_mixed_Attacker_Good_iRule</strong> from the <strong>Available</strong> to the
<strong>Enabled</strong> box</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="initiate-the-good-traffic-script">
<h3>Initiate the Good Traffic script<a class="headerlink" href="#initiate-the-good-traffic-script" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>The jumpbox is used to generate legitimate traffic and bad traffic,
eth1 has 10.1.10.51-55 configured and 10.1.10.52 will be the
source-IP used for the good traffic script. The source IP will match
XFF_mixed_Attacker_Good_iRule and a X-Forward For header will be
placed in the HTTP request in the 153.172.223.0/24 IP address range.</p>
<p>In your home directory (/home/f5student), you will find the two
scripts used for this lab:</p>
<p><strong>baseline_menu.sh</strong> - is used to create baseline traffic</p>
<p><strong>AB_DOS.sh</strong> - is used to do a L7 DOS attack</p>
<p>The baseline traffic script gives two options: increasing traffic
and alternate traffic.</p>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Start baseline traffic, make sure you are in your home directory, the
type:</p>
<blockquote>
<div><p>./baseline_menu.sh</p>
</div></blockquote>
</li>
</ol>
<ol class="loweralpha">
<li><p class="first">Select option 2 <strong>alternate</strong> and keep it running in the window</p>
<blockquote>
<div><p>This is your valid traffic and the number of requests does change
based on time. The request itself changes as well. The User-Agent
changes with each request and the requested URI also. Both are
randomly taken from files in the “source” directory in the home
directory.</p>
<p>BaDoS can now learn how “good” traffic looks.</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Now ssh into the BIG-IP. You can use PuTTY or a terminal window to do
this.</p>
<ol class="loweralpha simple">
<li>From a terminal window:</li>
</ol>
<blockquote>
<div><p>ssh <a class="reference external" href="mailto:root&#37;&#52;&#48;10&#46;1&#46;1&#46;245">root<span>&#64;</span>10<span>&#46;</span>1<span>&#46;</span>1<span>&#46;</span>245</a></p>
</div></blockquote>
</li>
</ol>
<ol class="loweralpha simple">
<li>Or select the PuTTY icon at the bottom <a class="reference internal" href="../_images/image13.png"><img alt="image12" src="../_images/image13.png" style="width: 0.38298in; height: 0.41677in;" /></a> and then <strong>bigip01</strong>
from the Saved Sessions.</li>
</ol>
<ol class="arabic">
<li><p class="first">The admd daemon will generate output that shows various important
signals. The syntax for the “admd” command is:</p>
<blockquote>
<div><p>admd -s
vs./Common/vs_hackazon_http+/Common/hackazon_bados.info.learning</p>
</div></blockquote>
</li>
</ol>
<p>NOTE: You may need to hit return &lt;cr&gt; twice to get the output started.</p>
<ol class="loweralpha">
<li><p class="first">/Common/vs_hackazon_http – is the name of the virtual server</p>
</li>
<li><p class="first">/Common/hackazon_bados – is the name of the DoS profile.</p>
<blockquote>
<div><p>Here is a sample output:</p>
<p><a class="reference internal" href="../_images/image14.png"><img alt="image13" src="../_images/image14.png" style="width: 6.04739in; height: 1.38762in;" /></a></p>
<p>The first number is the approximation of learned baseline or, in
other words, how confident the BIG-IP is that it has a solid
baseline of normal traffic.</p>
</div></blockquote>
</li>
</ol>
<p>Note: It may take 5 or more minutes before you begin to get learned
baseline numbers.</p>
<blockquote>
<div><p>For purpose of this lab, once your learned baseline gets around 90%
you can continue. The longer it runs, the better it is, because the
system is self-adjusting permanently. So, in a normal environment it
is constantly updating.</p>
<p>While you wait. The output of the <strong>info.learning</strong> signal, which 4
comma-separated values that show the status of the admd behavioral
dos learning:</p>
<p><strong>info.learning</strong> show estimates for behavioral DoS baseline
readiness</p>
<p>The signal values are:</p>
<p>[baseline_learning_confidence, learned_bins_count ,
good_table_size , good_table_confidence]</p>
</div></blockquote>
<ul>
<li><dl class="first docutils">
<dt><strong>Baseline_learning_confidence</strong> in % - how confident the system is</dt>
<dd><p class="first last">in the baseline learning.</p>
</dd>
</dl>
</li>
<li><p class="first"><strong>Learned_bins_count</strong> - number of learned bins</p>
</li>
<li><p class="first"><strong>Good_table_size</strong> - number of learned requests</p>
</li>
<li><dl class="first docutils">
<dt><strong>Good_table_confidence</strong> - how confident, as a percentage, the</dt>
<dd><blockquote class="first">
<div><p>system is in the good table. It must be 100% for behavioral
signatures.</p>
</div></blockquote>
<p>For the lab/demo to be successful, you should wait until:</p>
<ul class="simple">
<li>baseline_learning_confidence &gt; 80% (90%+ is better)</li>
<li>learned_bins_count &gt; 0</li>
<li>good_table_size &gt; 2000</li>
<li>good_table_confidence = 100</li>
</ul>
<p>If you would like to see all of the values available, simply enter
‘admd -s vs./Common/vs_hackazon_http’ where you can see a wide
range of interesting statistics. To see L7 DOS logs check this file:</p>
<p class="last"># tail -f /var/log/dosl7/dosl7d.log</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="initiated-a-l7-ddos-attack">
<h3>Initiated a L7 DDoS attack<a class="headerlink" href="#initiated-a-l7-ddos-attack" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>In this task you will initiated an L7 DDoS attack on the hackazon
virtual server, from eth1 and 10.1.10.53 will be the source-IP used
for the L7 DDoS script. This source IP will match
XFF_mixed_Attacker_Good_iRule and a X-Forward For header will be
placed in the HTTP request in the 132.173.99.0/24 IP address range.</p>
<p>Once the attack begins the BIG-IP WAF (ASM) will immediately switch
into Attack mode, because the server health deteriorates almost
immediately. As the server gets totally overwhelmed, you may at
first the good script dropping requests. <em>That’s why BaDoS first
mitigates with a global rate limit just to protect the server</em>. In a
short time, the good script will go back to 200 OK. During this time
BaDoS starts to generate <strong>Dynamic Signatures</strong> to identify the bad
traffic and mitigates on that level. The server health will get
better and after a short while because only <strong>Dynamic Signatures</strong>
will be blocking traffic.</p>
</div></blockquote>
<ol class="arabic">
<li><p class="first">On the BIG-IP open a tab/window, go to <strong>Security ›› DoS Protection :
Signatures</strong> click on the <strong>Dynamic</strong> box and set the <strong>Refresh</strong> to
<strong>20 secs</strong>. Open another tab/window and go to <strong>Security ››
Reporting : DoS : Dashboard</strong>. The dashboard is NOT realtime, in may
take up to 10 minutes for traffic to display.</p>
</li>
<li><p class="first">On the xjumpbox open a NEW terminal window. From your home directory
enter:</p>
<blockquote>
<div><p># ./AB_DOS.sh</p>
</div></blockquote>
</li>
</ol>
<ol class="loweralpha simple">
<li>Select <strong>2</strong> – Attack start - score</li>
</ol>
<ol class="arabic simple">
<li>Take a view on the <strong>Security ›› DoS Protection : Signatures</strong> in the
BIG-IP GUI and you will see the created Signature. When you click on
the signature (NOT on the blue link, but somewhere on the signature
bar), you will get the details about the Signature, which is in
Wireshark format.</li>
</ol>
<p><a class="reference internal" href="../_images/image15.png"><img alt="image14" src="../_images/image15.png" style="width: 6.91667in; height: 2.98958in;" /></a></p>
<ol class="arabic">
<li><p class="first">At the BIG-IP CLI prompt using the following command you will get you
a list of all grey-listed IPs (bad actors).</p>
<blockquote>
<div><p>ipidr -l /Common/vs_hackazon_http+/Common/hackazon_bados</p>
<p><a class="reference internal" href="../_images/image16.png"><img alt="image15" src="../_images/image16.png" style="width: 5.64437in; height: 2.98936in;" /></a></p>
</div></blockquote>
</li>
</ol>
<p>They all have a TTL, which indicated their live-time. Before they
time-out, BaDOS will check if they are still attacking. If this is the
case, the TTL gets increased again, otherwise the IP get released again.</p>
<p>When this happens, you will see on the “Mitigation Panel” traffic marked
as “Quarantine”.</p>
<ol class="arabic simple">
<li>In the terminal window where you are performing you attack enter:<ol class="loweralpha">
<li><strong>&lt;ctrl&gt;C</strong> then <strong>3</strong> then <strong>4</strong> to close down the attack
cleanly.</li>
</ol>
</li>
<li>View the <strong>Security ›› Reporting : DoS : Dashboard</strong>, this is not
real time. It may take up to 10 minutes for the attack to show.</li>
</ol>
</div>
</div>
</div>
<div class="section" id="exercise-2-mitigating-bot-attacks">
<h1>Exercise 2 - Mitigating BoT Attacks<a class="headerlink" href="#exercise-2-mitigating-bot-attacks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mitigating-bots-using-a-dos-profile">
<h2>Mitigating Bots using a DOS profile<a class="headerlink" href="#mitigating-bots-using-a-dos-profile" title="Permalink to this headline">¶</a></h2>
<p>Objectives:</p>
<ul class="simple">
<li>Scan the web site using a spider (OWASP ZAP)</li>
<li>Create a Denial of Service Profile</li>
<li>Enable the Proactive Bot Defense</li>
<li>Associate the DoS profile with an existing virtual server</li>
<li>Estimated time for completion: <strong>15 minutes</strong></li>
</ul>
<div class="section" id="initiate-a-bot-attack">
<h3>Initiate a bot attack<a class="headerlink" href="#initiate-a-bot-attack" title="Permalink to this headline">¶</a></h3>
<p>You are now going to use the OWASP ZAP tool to run a spider bot attack
against the Hackazon website.</p>
<ol class="arabic">
<li><p class="first">From the <strong>Applications Menu</strong> in the upper left-hand corner of the
jumpbox go to <strong>OWASP &gt; Proxies &gt; ZAP</strong>.</p>
</li>
<li><p class="first">Once ZAP is open, click on <strong>Start</strong> when asked <strong>Do you want to
persist the ZAP session</strong>.</p>
</li>
<li><p class="first">In the <strong>Quick Start</strong> tab, in the <strong>URL Attack</strong> box, enter
<a class="reference external" href="http://hackazon.f5demo.com">http://hackazon.f5demo.com</a> and hit the <strong>Attack</strong> button<strong>.</strong></p>
<blockquote>
<div><p><a class="reference internal" href="../_images/image17.png"><img alt="image16" src="../_images/image17.png" style="width: 3.97688in; height: 1.88376in;" /></a></p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Once the attack has started a <strong>Spider</strong> tab should appear in the
bottom ZAP window. You will see ZAP crawling the web site. Stop the
attack after you have observed this.</p>
<blockquote>
<div><p><a class="reference internal" href="../_images/image18.png"><img alt="image17" src="../_images/image18.png" style="width: 5.61272in; height: 1.45295in;" /></a></p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="creating-modifying-a-dos-profile">
<h3>Creating/Modifying a DoS Profile<a class="headerlink" href="#creating-modifying-a-dos-profile" title="Permalink to this headline">¶</a></h3>
<p>Now you will modify your DoS profile to prevent malicious bots from
attacking the Hackazon web site.</p>
<ol class="arabic simple">
<li>Create/modify a DoS profile using the information in the following
table. Go to you <strong>hackazon_bados</strong> profile and select the
<strong>Application Security</strong> tab.</li>
<li>Select under <strong>Application Security</strong> select <strong>Proactive Bot
Defense</strong> and the <strong>Edit All</strong> link.</li>
<li>Modify the properties of the DoS Profile by opening the new DoS
Profile and customize the profile using the information in the table
below. Set the <strong>Operation Mode</strong> to <strong>Always</strong>, make sure both boxes
are checked in the <strong>Block requests from suspicious browsers</strong>
section. The <strong>Grace Period</strong> should be set to <strong>5</strong> seconds and
<strong>Cross-Domain Request</strong> should be set to <strong>Allow all requests</strong>.
(see figure below). <strong>DO NOT HIT UPDATE YET</strong> for lab purposes.</li>
</ol>
<p><a class="reference internal" href="../_images/image19.png"><img alt="image18" src="../_images/image19.png" style="width: 6.22016in; height: 4.77660in;" /></a></p>
<ol class="arabic">
<li><p class="first">Under <strong>Application Security</strong> select <strong>Bot Signatures</strong> and change
the <strong>Malicious Categories</strong> section to <strong>Block</strong>.</p>
<p><a class="reference internal" href="../_images/image20.png"><img alt="image19" src="../_images/image20.png" style="width: 5.98606in; height: 1.74468in;" /></a></p>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Now click on the <strong>Update</strong> button at the bottom of the page.</p>
<blockquote>
<div><p><strong>NOTE:</strong> If you are still running the baseline_menu.sh with “good”
traffic, you may start seeing drops or 307s. This is because some of
the random user agents are actually bot signatures.</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic simple">
<li>Using the OWASP ZAP tool, attack the website again. Notice this time
the attack was stopped.</li>
</ol>
<p><a class="reference internal" href="../_images/image21.png"><img alt="image20" src="../_images/image21.png" style="width: 5.28902in; height: 1.33034in;" /></a></p>
<ol class="arabic simple">
<li>If you run the AB_DOS.sh script again you will find the DoS attack
is blocked by BoT mitigation saving the network and the BIG-IP from
unnecessary traffic.</li>
<li>On you DoS Dashboard you can see information about the BoT attacks</li>
</ol>
<p><a class="reference internal" href="../_images/image22.png"><img alt="image21" src="../_images/image22.png" style="width: 7.30556in; height: 3.68542in;" /></a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="logging.html" class="btn btn-neutral float-right" title="logging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Intro to ASM Behavioral DoS.html" class="btn btn-neutral" title="Agility 2018" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Michael Everett.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>